function Cenny(e,t){function r(e,t){var n="";setInterval(function(){i.get(function(r){var i={};if(t!==undefined){for(var s=0;s<t.length;s++){i[t[s]]=r[t[s]]}}else{i=r}var o=JSON.stringify(i);if(o!==n){e(i);n=JSON.stringify(i)}},t)},1500)}this.stats={};this.stats.obj={};this.stats.getTime=function(){var e=(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");return e};this.stats.obj.log=[];this.stats.obj.totalRequests=0;this.stats.get=function(){return i.stats.obj};this.stats.userRequestsPS=0;setInterval(function(){i.stats.userRequestsPS=0},1e4);this.stats.isAllowed=function(){if(i.stats.userRequestsPS>10){return false}else{return true}};this.user={};this.user.clientID=Math.floor(Math.random()*329733);this.group={};this.secure={};this.groupObject={};this.groupObject.group="default";this.userObject={};this.userObject.user="default";this.userObject.pass="default";this.url=document.URL+"cenny.php";this.user.scanForToken=function(){var e=[];setInterval(function(){var t=localStorage.getItem("cennyToken");t=JSON.parse(t);if(t!==null&&t!==undefined&&t!==[]){if(t[2]===i.userObject.user){if(e!==t[0]){if(t[1]!==i.user.clientID){if(i.userObject.pass!==t[0]){i.userObject.pass=t[0];e=t[0]}}}}}},500)};this.user.scanForToken();if(typeof e==="string"){this.url=e}else{console.error({cenError:"url to cenny.php not given"})}if(typeof t==="string"){if(Mg.validate.username(t).isValid===true){this.groupObject.group=t}else{console.error({cenError:"group invalid"})}}var n=localStorage.getItem("cennyUser");n=JSON.parse(n);if(n!=="null"&&n!==null){if(typeof n==="object"){if(n.group===this.groupObject.group){this.userObject.user=n.user;this.userObject.pass=n.pass}}}this.aj=function(e,t,n){if(t===undefined||typeof t!=="function"){t=function(e){console.info(e)}}if(navigator.onLine===true){var r=true;if(n!==undefined){if(Mg.validate.username(n[0]).isValid===true){if(Mg.validate.password(n[1]).isValid===true){}else{t(Mg.validate.password(n[1]));r=false}}else{t(Mg.validate.username(n[0]));r=false}}if(r===true){if(n!==undefined&&n instanceof Array){var s=n[0];var o=n[1];Mg.requests.add(e,[i.groupObject.group,s,o],t,i.url);i.stats.obj.log.push([e.action,e,i.stats.getTime()]);if(i.stats.obj[e.action]===undefined){i.stats.obj[e.action]={};i.stats.obj[e.action].count=0;i.stats.obj[e.action].log=[]}i.stats.obj[e.action].count++;i.stats.obj[e.action].log.push([e,i.stats.getTime()]);i.stats.obj.totalRequests++}else{if(Mg.validate.username(i.userObject.user).isValid===true){if(Mg.validate.password(i.userObject.pass).isValid===true||i.userObject.user==="default"&&i.userObject.pass==="default"){Mg.requests.add(e,[i.groupObject.group,i.userObject.user,i.userObject.pass],t,i.url);i.stats.obj.log.push([e.action,e,i.stats.getTime()]);if(i.stats.obj[e.action]===undefined){i.stats.obj[e.action]={};i.stats.obj[e.action].count=0;i.stats.obj[e.action].log=[]}i.stats.obj[e.action].count++;i.stats.obj[e.action].log.push([e,i.stats.getTime()]);i.stats.obj.totalRequests++}else{t(Mg.validate.password(i.userObject.pass))}}else{t(Mg.validate.username(i.userObject.user))}}}}};this.get=function(e,t){if(typeof t==="string"){if(t===i.userObject.user){t=""}}var n=navigator.onLine;if(n===true){if(t===undefined||t===""){i.aj({data:"all",action:"get"},e)}else if(t instanceof Array){var r="";for(var s=0;s<t.length;s++){if(t[s+1]!==undefined){r+=t[s]+"@n@"}else{r+=t[s]}}i.aj({data:r,action:"get"},e)}else{if(Mg.validate.username(t).isValid===true){i.aj({action:"getOther",data:t},e)}else{e({cenError:"username invalid"})}}}else if(n===false){var o=i.offline.getOfflineObject();if(t===undefined||t===""){e(o)}else if(t instanceof Array){var u={};for(var s=0;s<t.length;s++){for(key in o){if(t[s]===key){u[key]=o[key]}}}e(u)}else{e({cenError:"getting properties from user while offline is not possible"})}}};this.update=function(e,t,n){if(typeof t==="string"){if(t===i.userObject.user){t=""}}var r=navigator.onLine;if(r===true){e["cennyJS"]=true;if(t===undefined||t===""||typeof t==="function"){i.aj({data:e,action:"update"},t)}else{if(Mg.validate.username(t).isValid===true){i.aj({otherUser:t,data:e,action:"updateOther"},n)}else{n({cenError:"username invalid"})}}}else if(r===false){e["cennyJS"]=true;if(t===undefined||t===""||typeof t==="function"){i.offline.update(e)}}setTimeout(function(){i.offline.updateOfflineObject()},10)};this.set=function(e,t,n){if(typeof t==="string"){if(t===i.userObject.user){t=""}}var r=navigator.onLine;if(r===true){if(e instanceof Object){e["cennyJS"]=true;if(t===undefined||t===""){i.aj({data:e,action:"set"},n)}else if(typeof t==="function"){i.aj({data:e,action:"set"},t)}else{if(Mg.validate.username(t).isValid===true){i.aj({data:e,action:"setOther",otherUser:t},n)}else{n({cenError:"username invalid"})}}}}else if(r===false){if(e instanceof Object){e["cennyJS"]=true;if(t===undefined||t===""){i.offline.set(e)}else if(typeof t==="function"){i.offline.set(e);t("updated (offline)")}}}setTimeout(function(){i.offline.updateOfflineObject()},10)};this.user.remove=function(e){if(e===undefined){e=function(e){console.log(e)}}i.aj({data:"",action:"removeUser"},function(t){if(t.cenError===undefined){i.userObject.user="default";i.userObject.pass="default";i.user.forget()}e(t)})};this.user.permissions=function(e,t){if(t===undefined){t=function(e){console.log(e)}}i.aj({data:"",action:"getPermissions"},function(n){console.log(n);if(n.cenError!=="permissions cannot be retrieved for default user"){var r={};for(key in n){r[key]=n[key]}for(key in e){r[key]=e[key]}console.log(n);i.aj({data:JSON.stringify(r),action:"setPermissions"},t)}else{t({cenError:"permissions cannot be edited on default user"})}})};this.user.remember=function(){localStorage.setItem("cennyUser",JSON.stringify({user:i.userObject.user,pass:i.userObject.pass,group:i.groupObject.group}))};this.user.forget=function(){localStorage.setItem("cennyUser","null")};this.user.password=function(e,t){if(t===undefined){t=function(e){console.log(e)}}if(i.stats.isAllowed()===true){if(Mg.validate.password(e).isValid===true){i.aj({data:e,action:"changePass"},t)}else{t(Mg.validate.password(e))}i.stats.userRequestsPS++}else{t({cenError:"server did not respond"})}};this.user.signin=function(e,t,n){if(n===undefined){n=function(e){console.log(e)}}if(i.stats.isAllowed()===true){if(typeof e==="string"&&typeof t==="string"){if(e!==i.userObject.user){i.offline.syncWithBackend();if(Mg.validate.username(e).isValid===true&&Mg.validate.password(t).isValid===true){if(typeof n==="function"){i.aj({data:"",action:"generateAuthToken"},function(r){if(r.cenError!==undefined){n(r)}else{i.userObject.user=e;i.userObject.pass=t;i.userObject.pass=r;localStorage.setItem("cennyToken",JSON.stringify([r,i.user.clientID,i.userObject.user]));i.user.remember();n({cenInfo:"signed in"})}},[e,t])}}else{n({cenError:"username or password invalid"})}}else{n({cenError:"already signed in"})}}else{n({cenError:"first and second parameters should be username and password"})}}else{n({cenError:"server did not respond"})}i.stats.userRequestsPS++};this.user.signout=function(e){if(e!==undefined){e=function(e){}}if(i.userObject.user!=="default"){i.userObject.pass="default";i.userObject.user="default";i.aj({data:"",action:"generateAuthToken"},function(e){});i.user.forget()}e({cenInfo:"success"})};this.user.exists=function(e,t){i.aj({data:t,action:"userExists"},function(t){if(t===true){e(true)}else{e(false)}})};this.user.create=function(e,t,n){if(n===undefined){n=function(e){console.log(e)}}if(i.stats.isAllowed()===true){if(typeof e==="string"&&typeof t==="string"){if(Mg.validate.username(e).isValid===true){if(Mg.validate.password(t).isValid===true){i.aj({action:"createuser",data:{username:e,password:encodeURIComponent(t)}},n)}else{n(Mg.validate.password(t))}}else{n(Mg.validate.username(e))}}else{n({cenError:"first and second parameters should be username and password"})}i.stats.userRequestsPS++}else{n({cenError:"server did not respond"})}};this.user.info=function(e){if(e!==undefined){e([i.userObject.user,i.userObject.pass])}return[i.userObject.user,i.userObject.pass]};this.offline={};this.offline.update=function(e){var t=localStorage.getItem("cennyOfflineUpdate");if(t===undefined||t===null){t={}}else{t=JSON.parse(t)}for(key in e){if(key==="DELETE"){var n=JSON.parse(localStorage.getItem("cennyOffline"));for(var r=0;r<e[key].length;r++){delete t[e[key][r]];delete n[e[key][r]]}localStorage.setItem("cennyOffline",JSON.stringify(n))}else{t[key]=e[key]}}t=JSON.stringify(t);localStorage.setItem("cennyOfflineUpdate",t);i.offline.setDataUsername()};this.offline.setDataUsername=function(){localStorage.setItem("cennyOfflineUsername",i.userObject.user)};this.offline.set=function(e){e=JSON.stringify(e);localStorage.setItem("cennyOffline",e);localStorage.setItem("cennyOfflineUpdate",e);i.offline.setDataUsername()};this.offline.syncWithBackend=function(){var e=navigator.onLine;if(e===true){var t=localStorage.getItem("cennyOfflineUpdate");var n=localStorage.getItem("cennyOfflineUsername");if(t===undefined||t===null){t={}}else{t=JSON.parse(t)}if(n===i.userObject.user){i.update(t);localStorage.setItem("cennyOfflineUpdate",JSON.stringify({}))}}};this.offline.getOfflineObject=function(){var e=localStorage.getItem("cennyOfflineUpdate");var t=localStorage.getItem("cennyOffline");if(t===undefined||t===null){t={}}else{t=JSON.parse(t)}if(e===undefined||e===null){e={}}else{e=JSON.parse(e)}var n={};for(key in t){n[key]=t[key]}for(key in e){n[key]=e[key]}return n};setTimeout(function(){var e=JSON.parse(localStorage.getItem("cennyOfflineUpdate"));if(e!=={}){var t=true;var n=localStorage.getItem("lastOffline");if(n!==null){if(n==="false"){t=false}}else{t=false}if(t===true){localStorage.setItem("lastOffline","false");i.offline.syncWithBackend()}}},100);this.offline.lastState=navigator.onLine;setInterval(function(){if(navigator.onLine!==i.offline.lastState){if(navigator.onLine===true){console.log({cenInfo:"came back online : syncing"});i.offline.syncWithBackend();localStorage.setItem("lastOffline","false")}else{console.log({cenInfo:"went offline"});localStorage.setItem("lastOffline","true")}i.offline.lastState=navigator.onLine}},300);this.offline.updateOfflineObject=function(){var e=navigator.onLine;if(e===true){i.get(function(e){var t=e;localStorage.setItem("cennyOffline",JSON.stringify(t))})}else{}};this.modified=function(e,t){var n=new r(e,t)};var i=this}var Mg={};Mg.validate={};Mg.validate.username=function(e){var t={isValid:true,reasons:[],type:"username"};if(typeof e!=="string"){t.isValid=false;t.reasons.push("Username is not a valid string")}else{if(e.match(/^[A-Za-z0-9_]+$/)){}else{t.isValid=false;t.reasons.push("Username contains special characters")}}if(e.length>24){t.isValid=false;t.reasons.push("Username too long")}if(e.length<5){t.isValid=false;t.reasons.push("Username too short")}return t};Mg.validate.password=function(e){var t={isValid:true,reasons:[],type:"password"};if(typeof e!=="string"){t.isValid=false;t.reasons.push("Password is not a valid string")}else{if(e.match(/^[A-Za-z]+$/)){t.isValid=false;t.reasons.push("Password must contain at least one special character")}}if(e.length>70){t.isValid=false;t.reasons.push("Password too long")}if(e.length<5){t.isValid=false;t.reasons.push("Password too short")}return t};Mg.validate.object=function(e){var t=true;var n=0;for(key in e){n++;if(key.length>100){t=false}}if(n>5e3){t=false}return t};Mg.isJSON=function(e){try{JSON.parse(e)}catch(t){return false}return true};Mg.convertData=function(e){var t=Mg.isJSON(e);if(t===true){return JSON.parse(e)}else{if(e.search("}{")!==-1){e=e.replace(/}{/g,",");if(Mg.isJSON(e)===true){return JSON.parse(e)}}return e}};Mg.countObj=function(e){var t=0;for(key in e){t++}return t};Mg.getTime=function(){var e={};var t=new Date;var n=new Date(t.getFullYear(),0,0);var r=t-n;var i=1e3*60*60*24;var s=Math.floor(r/i);var o=(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");o=o.split(":");e.second=parseInt(o[2]);e.minute=parseInt(o[1]);e.hour=parseInt(o[0]);e.day=s;e.year=t.getFullYear();return e};Mg.makeID=function(){var e="";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var n=0;n<15;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e};Mg.requests={};Mg.requests.removeRequest=function(e){var t=[];var n=[];for(var r=0;r<Mg.requests.queue.length;r++){if(r!==e){t.push(Mg.requests.queue[r])}}for(var r=0;r<Mg.requests.queue_callbacks.length;r++){if(r!==e){n.push(Mg.requests.queue_callbacks[r])}}Mg.requests.queue=t;Mg.requests.queue_callbacks=n};Mg.requests.url="";Mg.requests.auth=[];Mg.requests.queue=[];Mg.requests.queue_callbacks=[];Mg.requests.processing=false;Mg.requests.sent_queue=[];Mg.requests.sent_queue_callbacks=[];Mg.requests.total=0;Mg.requests.isBusy=false;Mg.requests.add=function(e,t,n,r){Mg.requests.auth=t;Mg.requests.url=r;var i=true;for(var s=0;s<Mg.requests.queue.length;s++){if(JSON.stringify(e)===JSON.stringify(Mg.requests.queue[s])){i=false;Mg.requests.queue_callbacks[s].push(n)}}if(i===true){Mg.requests.queue.push(e);Mg.requests.queue_callbacks.push([n])}};Mg.requests.send=function(){if(Mg.requests.isBusy===false){var e;e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){setTimeout(function(){Mg.requests.isBusy=false;Mg.requests.processing=false},70);var t=Mg.requests.queue_callbacks;var n=Mg.requests.queue;var r=e.responseText;r=Mg.convertData(r);for(var i=r.length;i+1>0;i--){Mg.requests.removeRequest(i)}for(var i=0;i<r.length;i++){var s=t[i];if(s!==undefined){for(var o=0;o<s.length;o++){s[o](r[i])}}}}};var t=Mg.requests.queue;Mg.requests.processing=true;e.open("POST",Mg.requests.url,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.send("requests="+JSON.stringify(t)+"&groupName="+Mg.requests.auth[0]+"&userName="+Mg.requests.auth[1]+"&userPass="+Mg.requests.auth[2]);Mg.requests.total++;Mg.requests.isBusy===true}};Mg.requests.sender=setInterval(function(){if(Mg.countObj(Mg.requests.queue)>0){if(Mg.requests.processing!==true){console.log(JSON.stringify(Mg.requests.queue));Mg.requests.send()}else{}}},300);